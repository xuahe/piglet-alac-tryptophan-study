---
title: 'Fig2H. Postprandial Trp and formula intake relationship at 120 min postmeal'
author: "Xuan He"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  html_document: 
    toc: true
    toc_depth: 3
  html_notebook: 
    toc: true
    toc_depth: 3
---
<style type="text/css">
body{ /* Normal  */ font-size: 12px;}
td {  /* Table  */ font-size: 10px;}
h1.title {font-size: 22px; color: DarkRed; font-style: bold;}
h1 { /* Header 1 */ font-size: 16px; color: mediumblue; font-style: bold;}
h2 { /* Header 2 */ font-size: 13px; color: mediumblue; font-style: bold;}
h3 { /* Header 3 */ font-size: 11px; font-family: "Times New Roman", Times, serif; color: mediumblue;}
code.r{ /* Code block */ font-size: 12px;}
pre { /* Code block - determines code spacing between lines */ font-size: 12px;}
</style>

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/xuanhe89/Documents/WorkSpace/Research projects/Lactation/ALAC/Manuscripts/Paper #1/Figures and Tables R codes')

```


# Clean up the environment
```{r}
rm(list = ls())
```


# Load library
```{r message=FALSE}
library(readxl)       # For reading Excel files
library(ggpubr)       # For creating publication-ready plots
library(dplyr)        # For data manipulation
```


# Load required libraries for data reading, plotting, and data manipulation
```{r}
# Targeted MS data
PP.targeted.serum <- read_excel("Data/Data.xlsx", sheet = "PP_serum_MS")
# Pig info and postprandial metadata
PigInfo <- read_excel("Data/Data.xlsx", sheet = "PigInfo")
PP_metadata <- read_excel("Data/Data.xlsx", sheet = "PP_metadata")
```

# Data organization

```{r}
PP_Feed.intake <- PP_metadata %>% select(PigID, PPfeedIntake.g)
```


```{r}
# Calculate tryptophan intake (in mg) for each pig based on their diet
Trp.intake <- PP_metadata %>% inner_join(PigInfo, by = "PigID") %>%
                  mutate(Trp_intake = if_else(Diet == "ALAC", PPfeedIntake.g * 1.03, PPfeedIntake.g * 0.89)) %>% # Calculate tryptophan intake based on the assigned diet
                  select(PigID, Trp_intake)    
```

# Figure
```{r fig.width=5.5, fig.height=5}
# Filter data for the 120-minute time point, join with tryptophan intake data, and create scatter plot
Fig <- PP.targeted.serum %>% inner_join(PigInfo, by = "PigID") %>%
          filter(TimePoint == "120 min") %>%
          select(PigID, Diet, Tryptophan) %>%
          inner_join(Trp.intake, by = "PigID") %>%
          ggscatter(x = "Tryptophan", y = "Trp_intake", 
                    xlab = "Serum tryptophan at 120 min post-meal (uM)", ylab = "Tryptophan intake from formula (mg)",
                    palette = c("turquoise3","purple"), add = "reg.line") + stat_cor(method = "pearson", label.x = 120) 


# Save the figure as a pdf file
ggsave(plot=Fig, height=5, width=5.5, dpi=300, filename="Figure 2/Fig2H.pdf", useDingbats=FALSE)


Fig
```




```{r}
sessionInfo()
```