---
title: 'Fig2G. Postprandial Trp lineplots'
author: "Xuan He"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  html_document: 
    toc: true
    toc_depth: 3
  html_notebook: 
    toc: true
    toc_depth: 3
---
<style type="text/css">
body{ /* Normal  */ font-size: 12px;}
td {  /* Table  */ font-size: 10px;}
h1.title {font-size: 22px; color: DarkRed; font-style: bold;}
h1 { /* Header 1 */ font-size: 16px; color: mediumblue; font-style: bold;}
h2 { /* Header 2 */ font-size: 13px; color: mediumblue; font-style: bold;}
h3 { /* Header 3 */ font-size: 11px; font-family: "Times New Roman", Times, serif; color: mediumblue;}
code.r{ /* Code block */ font-size: 12px;}
pre { /* Code block - determines code spacing between lines */ font-size: 12px;}
</style>

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/xuanhe89/Documents/WorkSpace/Research projects/Lactation/ALAC/Manuscripts/Paper #1/Figures and Tables R codes')
```


# Clean up the environment
```{r}
rm(list = ls())
```

# Load required libraries for data reading, plotting, and data manipulation
```{r message=FALSE}
library(readxl)       # For reading Excel files
library(ggpubr)       # For creating publication-ready plots
library(dplyr)        # For data manipulation
```


# Load data
```{r}
# Targeted MS data
PP.targeted.serum <- read_excel("Data/Data.xlsx", sheet = "PP_serum_MS")

# Pig info
PigInfo <- read_excel("Data/Data.xlsx", sheet = "PigInfo")
PP_metadata <- read_excel("Data/Data.xlsx", sheet = "PP_metadata")
```

# Data organization

```{r fig.width=6, fig.height=5}
Fig1 <- PP.targeted.serum %>%
          inner_join(PigInfo, by = "PigID") %>%
          select(PigID, Diet, TimePoint, Tryptophan) %>%
          
          # Filter to keep only pigs with 4 time points and calculate baseline tryptophan
          group_by(PigID) %>%
          filter(n() == 4) %>%
          mutate(Baseline.Trp = Tryptophan[TimePoint == "baseline"]) %>%
          ungroup() %>%
          
          # Calculate adjusted tryptophan values
          mutate(Adjusted.Trp = Tryptophan - Baseline.Trp,
                 TimePoint = factor(TimePoint, levels = c("baseline", "30 min", "60 min", "120 min")),
                 Diet = factor(Diet, levels = c("ALAC", "WPI")),
                 PigID = factor(PigID)) %>%
          
          # Plot the results
          ggplot(aes(x = TimePoint, y = Adjusted.Trp, group = PigID, color = Diet)) +
              geom_point(size = 1.2, position = position_dodge(width = 0.2)) +
              geom_line(linewidth = 0.7, position = position_dodge(width = 0.2)) +
              scale_color_manual(values = c("turquoise3", "purple")) +
              geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
              labs(y = "Baseline adjusted tryptophan (uM)", x = "") +
              theme_classic2()

# save the figure to a pdf file:
ggsave(plot=Fig1, height=5, width=6, dpi=300, filename="Figure 2/Fig2G_left.pdf", useDingbats=FALSE)

Fig1
```

## Below is used as a color guide for PigID
```{r}
PP.targeted.serum %>%
  inner_join(PigInfo, by = "PigID") %>%
  select(PigID, Diet, TimePoint, Tryptophan) %>%
  
  # Filter to keep only pigs with 4 time points and calculate baseline tryptophan
  group_by(PigID) %>%
  filter(n() == 4) %>%
  mutate(Baseline.Trp = Tryptophan[TimePoint == "baseline"]) %>%
  ungroup() %>%
  
  # Calculate adjusted tryptophan values
  mutate(Adjusted.Trp = Tryptophan - Baseline.Trp,
         TimePoint = factor(TimePoint, levels = c("baseline", "30 min", "60 min", "120 min")),
         Diet = factor(Diet, levels = c("ALAC", "WPI")),
         PigID = factor(PigID)) %>%
  
  # Plot the results
  ggplot(aes(x = TimePoint, y = Adjusted.Trp, group = PigID, color = PigID)) +
      geom_point(size = 1.2, position = position_dodge(width = 0.2)) +
      geom_line(linewidth = 0.7, position = position_dodge(width = 0.2)) +
      geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
      labs(y = "Baseline adjusted tryptophan (uM)", x = "") +
      theme_classic2()
```

```{r fig.width=3, fig.height=5}
Fig2 <- PP_metadata %>% filter(PigID %in% c(25, 28, 12, 6, 1)) %>%
                          select(PigID, PPfeedIntake.g) %>%
                          ggdotchart(x = "PigID", y = "PPfeedIntake.g", 
                                     sorting = "descending", add = "segments", rotate = TRUE,
                                     dot.size = 8, color = "#00AFBB", ylab = "Formula intake (g)")


# Save the figure to a pdf file:
ggsave(plot=Fig2, height=5, width=3, dpi=300, filename="Figure 2/Fig2G_right.pdf", useDingbats=FALSE)

Fig2
```




```{r}
sessionInfo()
```