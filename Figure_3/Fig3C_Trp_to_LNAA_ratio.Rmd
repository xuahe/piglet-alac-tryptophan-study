---
title: 'Fig3C. Trp to LNAA ratio'
author: "Xuan He"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  html_document: 
    toc: true
    toc_depth: 3
  html_notebook: 
    toc: true
    toc_depth: 3
---
<style type="text/css">
body{ /* Normal  */ font-size: 12px;}
td {  /* Table  */ font-size: 10px;}
h1.title {font-size: 22px; color: DarkRed; font-style: bold;}
h1 { /* Header 1 */ font-size: 16px; color: mediumblue; font-style: bold;}
h2 { /* Header 2 */ font-size: 13px; color: mediumblue; font-style: bold;}
h3 { /* Header 3 */ font-size: 11px; font-family: "Times New Roman", Times, serif; color: mediumblue;}
code.r{ /* Code block */ font-size: 12px;}
pre { /* Code block - determines code spacing between lines */ font-size: 12px;}
</style>

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/xuanhe89/Documents/WorkSpace/Research projects/Lactation/ALAC/Manuscripts/Paper #1/Figures and Tables R codes')
```


# Clean up the environment
```{r}
rm(list = ls())
```

# Load required libraries for data reading, plotting, and data manipulation
```{r message=FALSE}
library(readxl)       # For reading Excel files
library(ggpubr)       # For creating publication-ready plots
library(dplyr)        # For data manipulation
library(ggh4x)        # For advanced facet functions in ggplot2
library(rstatix)      # For statistical tests and adding significance markers
library(knitr)        # For displaying tibbles in a nice table format
library(kableExtra)   # For enhancing table formatting
```


# Load data
```{r}
# Dietary composition
DietComp <- read_excel("Data/Data.xlsx", sheet = "DietComp")
# Serum, liver and brain metabolome data
Serum <- read_excel("Data/Data.xlsx", sheet = "Nec_serum_targeted")
Liver <- read_excel("Data/Data.xlsx", sheet = "Liver_targeted")
Brain <- read_excel("Data/Data.xlsx", sheet = "Brain_targeted")
# Pig info
PigInfo <- read_excel("Data/Data.xlsx", sheet = "PigInfo")
# Metadata related to necropsy, including feed intake information
Nec_metadata <- read_excel("Data/Data.xlsx", sheet = "Nec_metadata")
```


# Data organization
```{r}
Data.diet <- DietComp %>% filter(Variable %in% c("Tryptophan:LNAA")) %>% 
              select(Diet, Value) %>%
              mutate(Diet = case_when(
                     Diet == "ALAC diet" ~ "ALAC",
                     Diet == "WPI diet" ~ "WPI",
                     Diet == "Sow milk" ~ "SF")) %>%
              rename(Trp_to_LNAA = Value) %>%
              mutate(Region = "Diet") %>%
              relocate(Region, .before = Trp_to_LNAA) 

Data.serum <- Serum %>%
                mutate(Trp_to_LNAA = Tryptophan / rowSums(across(c(Isoleucine, Leucine, Valine, Phenylalanine, Tyrosine)), na.rm = FALSE)) %>%
                mutate(Region = "Serum") %>%
                select(PigID, Region, Trp_to_LNAA) 


Data.liver <- Liver %>% 
                mutate(Trp_to_LNAA = Tryptophan / rowSums(across(c(Isoleucine, Leucine, Valine, Phenylalanine, Tyrosine)), na.rm = FALSE)) %>%
                mutate(Region = "Liver") %>%
                select(PigID, Region, Trp_to_LNAA)


Data.brain <- Brain %>% mutate(Trp_to_LNAA = Tryptophan / rowSums(across(c(Isoleucine, Leucine, Valine, Phenylalanine, Tyrosine)), na.rm = FALSE)) %>%
                select(PigID, Region, Trp_to_LNAA) %>%
                na.omit()

```


# Plotting data
```{r fig.width=8.5, fig.height=4}
Fig <- bind_rows(Data.serum, Data.liver, Data.brain) %>%
        inner_join(PigInfo, by = "PigID") %>%
        select(Diet, Region, Trp_to_LNAA) %>%
        bind_rows(Data.diet) %>% # add the diet data
        mutate(Diet = factor(Diet, levels = c("ALAC", "WPI", "SF"))) %>%
        mutate(Region = factor(Region, levels = c("Diet", "Serum", "Liver", "Hippocampus", "Hypothalamus", "PFC", "Striatum"))) %>%
               ggerrorplot(x = "Region", y = "Trp_to_LNAA", color = "Diet", 
                           palette = c("turquoise3","purple", "orange"),
                           na.rm = TRUE, xlab = "", 
                           ylab ="Tryptophan:LNAA",  add = "mean_se", size = 0.6,
                           position = position_dodge(0.8)) +
                facet_grid2(.~Region, scales = "free") + # Use facet_grid2 to display regions separately
                theme(strip.background = element_blank(), strip.text.x = element_blank()) 

Fig 

# Save the figure in pdf format:
ggsave(plot=Fig, height=5, width=8.5, dpi=300, filename="Figure 3/Fig3C.pdf", useDingbats=FALSE)
```


# Statistical analysis
```{r}
bind_rows(Data.serum, Data.liver, Data.brain) %>%
        inner_join(PigInfo, by = "PigID") %>%
        select(Diet, Region, Trp_to_LNAA) %>%
        group_by(Region) %>% 
        wilcox_test(Trp_to_LNAA ~ Diet, paired = FALSE, p.adjust.method = "none") %>% # Perform Mann-whitney U test (Wilcox test)
        select(-p.adj, -p.adj.signif) %>%
        add_significance(cutpoints = c(0, 0.05, 0.1, 1), symbols = c("*", "#", "ns")) %>%
        filter(p.signif != "ns") %>%
        kable() %>% # Print the tibble in a nice table format
        kable_styling(bootstrap_options = c("striped", "hover")) # Enhance table formatting
```

```{r}
sessionInfo()
```