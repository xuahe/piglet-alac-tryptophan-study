---
title: 'SI Fig 2. Hb and Hct boxplot'
author: "Xuan He"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  html_document: 
    toc: true
    toc_depth: 3
  html_notebook: 
    toc: true
    toc_depth: 3
---
<style type="text/css">
body{ /* Normal  */ font-size: 12px;}
td {  /* Table  */ font-size: 10px;}
h1.title {font-size: 22px; color: DarkRed; font-style: bold;}
h1 { /* Header 1 */ font-size: 16px; color: mediumblue; font-style: bold;}
h2 { /* Header 2 */ font-size: 13px; color: mediumblue; font-style: bold;}
h3 { /* Header 3 */ font-size: 11px; font-family: "Times New Roman", Times, serif; color: mediumblue;}
code.r{ /* Code block */ font-size: 12px;}
pre { /* Code block - determines code spacing between lines */ font-size: 12px;}
</style>

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/xuanhe89/Documents/WorkSpace/Research projects/Lactation/ALAC/Manuscripts/Paper #1/Figures and Tables R codes')
```


# Clean up the environment
```{r}
rm(list = ls())
```


# Load libraries for data reading, plotting, statistical analysis
```{r message=FALSE, warning=FALSE}
library(readxl)       # For reading Excel files
library(ggpubr)       # For creating publication-ready plots
library(dplyr)        # For data manipulation
library(rstatix)      # For statistical tests and adding significance markers
library(knitr)        # For displaying tibbles in a nicely formatted table
library(kableExtra)   # For enhancing table formatting
```


# Load data
```{r}
# Load pig information and measurement of anemia status
PigInfo <- read_excel("Data/Data.xlsx", sheet = "PigInfo")
Anemia <- read_excel("Data/Data.xlsx", sheet = "Hb and Hct")
```


# Plot Hct and Hb
```{r}
Fig1 <- Anemia %>% 
            filter(!PigID %in% c(19, 24)) %>% ## Remove the two piglets where the blood in the heparin tube heavily coagulated
            inner_join(PigInfo, by = "PigID") %>% 
            mutate(Diet = factor(Diet, levels = c("ALAC", "WPI", "SF"))) %>%
            ggboxplot(y = "Hct_PD16", x = "Diet", 
                      fill = "Diet", palette = c("turquoise3","purple", "orange"),
                      xlab = "", ylab = "Hct", add = "jitter") 
```

```{r}
Fig2 <- Anemia %>% 
            filter(!PigID %in% c(19, 24)) %>% ## Remove the two piglets where the blood in the heparin tube heavily coagulated
            inner_join(PigInfo, by = "PigID") %>% 
            mutate(Diet = factor(Diet, levels = c("ALAC", "WPI", "SF"))) %>%
            mutate(Hb_PD16 = Hb_PD16/10) %>% # Hb was in g/L, convert unit
            ggboxplot(y = "Hb_PD16", x = "Diet", fill = "Diet", 
                      palette = c("turquoise3","purple", "orange"),
                      xlab = "", ylab = "Hb (g/dL)",  add = "jitter") 
```

```{r fig.width=7.5, fig.height=4}
Fig.all <- ggarrange(Fig1, Fig2, common.legend = TRUE)
Fig.all


# Save the figure in pdf:
ggsave(plot=Fig.all, height=4, width=7.5, dpi=300, filename="SI Figure 2/SI.Fig2.pdf", useDingbats=FALSE)
```

# Statistical analysis via Tukey HSD

```{r}
Anemia %>% filter(!PigID %in% c(19, 24)) %>% ## Remove the two piglets where the blood in the heparin tube heavily coagulated
             inner_join(PigInfo, by = "PigID") %>% 
             mutate(Diet = factor(Diet, levels = c("ALAC", "WPI", "SF"))) %>%
             tukey_hsd(Hb_PD16 ~ Diet) %>%
             kable() %>% # Print the tibble in a nicely formatted table
             kable_styling(bootstrap_options = c("striped", "hover")) # Enhance table formatting with kableExtra
```


```{r}
Anemia %>% filter(!PigID %in% c(19, 24)) %>% ## Remove the two piglets where the blood in the heparin tube heavily coagulated
              inner_join(PigInfo, by = "PigID") %>% 
              mutate(Diet = factor(Diet, levels = c("ALAC", "WPI", "SF"))) %>%
              tukey_hsd(Hct_PD16 ~ Diet) %>%
              kable() %>% # Print the tibble in a nicely formatted table
              kable_styling(bootstrap_options = c("striped", "hover")) # Enhance table formatting with kableExtra
```


```{r}
sessionInfo()
```