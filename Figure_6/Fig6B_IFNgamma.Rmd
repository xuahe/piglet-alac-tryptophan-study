---
title: 'Fig6C. Serum IFN gamma'
author: "Xuan He"
date: '`r format(Sys.time(), "%B %d, %Y")`'
output:
  html_document: 
    toc: true
    toc_depth: 3
  html_notebook: 
    toc: true
    toc_depth: 3
---
<style type="text/css">
body{ /* Normal  */ font-size: 12px;}
td {  /* Table  */ font-size: 10px;}
h1.title {font-size: 22px; color: DarkRed; font-style: bold;}
h1 { /* Header 1 */ font-size: 16px; color: mediumblue; font-style: bold;}
h2 { /* Header 2 */ font-size: 13px; color: mediumblue; font-style: bold;}
h3 { /* Header 3 */ font-size: 11px; font-family: "Times New Roman", Times, serif; color: mediumblue;}
code.r{ /* Code block */ font-size: 12px;}
pre { /* Code block - determines code spacing between lines */ font-size: 12px;}
</style>

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/xuanhe89/Documents/WorkSpace/Research projects/Lactation/ALAC/Manuscripts/Paper #1/Figures and Tables R codes')
```


# Clean up the environment
```{r}
rm(list = ls())
```


# Load necessary libraries for data reading, plotting, and statistical analysis
```{r message=FALSE}
library(readxl)       # For reading Excel files
library(ggpubr)       # For creating publication-ready plots
library(dplyr)        # For data manipulation
library(ggh4x)        # For advanced faceting functions in ggplot2
library(rstatix)      # For statistical tests and adding significance markers
library(knitr)        # For displaying tibbles in a nice table format
library(kableExtra)   # For enhancing table formatting
```


# Load data
```{r}
# Load cytokine measurements and pig information
Cytokines <- read_excel("Data/Data.xlsx", sheet = "Nec_serum_cytokines")
PigInfo <- read_excel("Data/Data.xlsx", sheet = "PigInfo")
```

# Perform statistical analysis
```{r}
# Perform Tukey's HSD test to evaluate group differences in IFN-gamma levels between diets
Cytokines %>% inner_join(PigInfo, by = "PigID") %>%
                tukey_hsd(`IFN-gamma` ~ Diet + SowID) %>%
                filter(term == "Diet")  %>%
                kable() %>% # Print the tibble in a nicely formatted table
                kable_styling(bootstrap_options = c("striped", "hover")) # Enhance table formatting with kableExtra
```

# Plotting IFN-gamma levels
```{r fig.width=3.3, fig.height=4}
Fig <- Cytokines %>% inner_join(PigInfo, by = "PigID") %>% 
                       rename(IFNgamma =`IFN-gamma`) %>%
                       select(Diet, IFNgamma) %>%
                       mutate(TimePoint = "Day 16") %>%
                       ggerrorplot(x = "TimePoint", y = "IFNgamma", color = "Diet", 
                                   palette = c("turquoise3","purple", "orange"),
                                   na.rm = TRUE, xlab = "", 
                                   ylab ="IFN-gamma (ug/L)",  add = "mean_se", position = position_dodge(0.6)) +
                        facet_nested(.~ TimePoint , scales = "free", space = "free_x") + 
                        theme_classic() + 
                        theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())

Fig


# Save the figure in pdf format
ggsave(plot=Fig, height=4, width=3.3, dpi=300, filename="Figure 6/Fig6B.pdf", useDingbats=FALSE)
```



```{r}
sessionInfo()
```